{% extends 'base.html' %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h3">Detalhes da O.S. #{{ os.id }}</h1>
    <div>
        <a href="{{ url_for('gerar_os_pdf', id=os.id) }}" class="btn btn-info" target="_blank">Gerar PDF / Imprimir</a>
        <a href="{{ url_for('listar_ordens') }}" class="btn btn-secondary">Voltar para a Lista</a>
    </div>
</div>

<div class="row">
    <div class="col-md-7">
        <div class="card shadow-sm mb-4">
            <div class="card-header">Informações do Cliente e Serviço</div>
            <div class="card-body">
                <p><strong>Cliente:</strong> {{ os.cliente.nome_exibicao }}</p>
                <p><strong>Telefone:</strong> {{ os.cliente.telefone_formatado }}</p>
                <hr>
                <p><strong>Data de Abertura:</strong> {{ os.data_criacao.strftime('%d/%m/%Y às %H:%M') }}</p>
                {% if os.data_fechamento %}<p><strong>Data de Fechamento:</strong> {{ os.data_fechamento.strftime('%d/%m/%Y às %H:%M') }}</p>{% endif %}
                
                <form action="{{ url_for('atualizar_status_os', os_id=os.id) }}" method="POST" class="row align-items-end">
                    <div class="col-9">
                        <label for="status_id" class="form-label"><strong>Status:</strong></label>
                        <select name="status_id" id="status_id" class="form-select">
                            {% for status in status_disponiveis %}
                                <option value="{{ status.id }}" {% if os.status_id == status.id %}selected{% endif %}>
                                    {{ status.nome }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-3">
                        <button type="submit" class="btn btn-primary w-100">Salvar Status</button>
                    </div>
                </form>
            </div>
        </div>
        </div>

    <div class="col-md-5">
        </div>
</div>
{% endblock %}

{% block scripts %}
<script>
$(document).ready(function() {
    $('#produto_id').select2({
        theme: "bootstrap-5",
        placeholder: "Digite para buscar um produto..."
    });
    $('#produto_id').on('change', function() {
        const selectedOption = $(this).find('option:selected');
        const valorVenda = selectedOption.data('valor') || 0;
        $('#valor_unitario').val(parseFloat(valorVenda).toFixed(2));
    });
});
</script>
{% endblock %}